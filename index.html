<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Import Duty and Tax Calculator | Estimate Customs Charges</title>
    <meta name="description" content="Use our Import Duty and Tax Calculator to easily estimate insurance, freight, assessable value, customs duties and taxes for your imports. Get accurate calculations based on HS codes, trade terms, and more.">
    <meta name="keywords" content="Import Duty and Tax Calculator, Duty Calculator, import duty, customs, tax calculation, Customs Tariff, customs duty, duty calculation">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://taxcalculator.bd/static/images/favicon.png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 50px 0px;
        }
        .calculator-container {
            width: 100%;
            max-width: 700px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 0 auto;
            transition: all 0.4s ease;
        }
        .calculator-container:hover {
            transform: translateY(-10px);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.2);
        }
        h1 {
            color: #4a4a4a;
            text-align: center;
            margin-bottom: 40px;
            font-size: 32px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
        }
        h1::after {
            content: '';
            display: block;
            width: 50px;
            height: 4px;
            background: linear-gradient(to right, #667eea, #764ba2);
            margin: 15px auto 0;
            border-radius: 2px;
        }
        .outlined-field {
            position: relative;
            margin-bottom: 30px;
        }
        .outlined-field input,
        .outlined-field select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            background-color: #ffffff;
            transition: all 0.3s ease;
            color: #4a4a4a;
        }
        .outlined-field input:focus,
        .outlined-field select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            outline: none;
        }
        .outlined-field label {
            position: absolute;
            top: -12px;
            left: 15px;
            background-color: white;
            padding: 0 8px;
            font-size: 14px;
            color: #9e9e9e;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        .outlined-field input:focus + label,
        .outlined-field select:focus + label,
        .outlined-field input:not(:placeholder-shown) + label,
        .outlined-field select:not([value=""]) + label {
            color: #667eea;
            font-weight: 600;
            font-size: 12px;
            top: -20px;
        }
        button[type="submit"] {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button[type="submit"]:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }
        #errorMessage {
            color: #ff6b6b;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            background-color: rgba(255, 107, 107, 0.1);
            display: none;
        }
        #loadingIndicator {
            text-align: center;
            margin-top: 20px;
            color: #667eea;
            font-weight: 600;
            display: none;
        }
        #results {
            margin-top: 40px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        #results table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        #results th, #results td {
            border: none;
            padding: 16px;
            text-align: left;
        }
        #results th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
        }
        #results td {
            border-bottom: 1px solid #e0e0e0;
        }
        #results tr:last-child td {
            border-bottom: none;
        }
        #results tr:nth-child(even) {
            background-color: #f8f9ff;
        }
        #results tr:hover {
            background-color: #e8ecfd;
        }
        #results td:first-child {
            font-weight: 600;
            color: #4a4a4a;
        }
        #results td:last-child {
            text-align: right;
            font-family: 'Roboto Mono', monospace;
        }
        #results .total-row {
            font-weight: bold;
            background-color: #e8ecfd;
        }
        #results .total-row td {
            border-top: 2px solid #667eea;
        }
        @media (max-width: 768px) {
            .calculator-container { padding: 5px; }
            h1 { font-size: 28px; }
            .outlined-field input, .outlined-field select, button[type="submit"] { font-size: 16px; }
            #results th, #results td { padding: 12px; }
        }

        /* Header & Footer Styles */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #f9f9f9;
            --text-color: #333;
            --light-gray: #f4f4f4;
            --dark-gray: #333;
            --white: #fff;
            --nav-bg: #0a192f;
            --mobile-menu-bg: #1a2636;
        }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--text-color); line-height: 1.6; }
        .header {
            background-color: var(--white);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .top-bar { background-color: var(--light-gray); padding: 4px 0; font-size: 14px; }
        .top-bar-icon { color: var(--text-color); text-decoration: none; margin-right: 15px; transition: color 0.3s ease; }
        .top-bar-icon:hover { color: var(--primary-color); }
        .navbar { padding: 4px 0; background-color: var(--nav-bg); }
        .navbar-brand { padding: 0; }
        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .navbar-nav { margin-left: auto; }
        .nav-item { margin: 0 5px; }
        .nav-link {
            color: var(--white) !important;
            font-size: 14px;
            font-weight: 500;
            padding: 8px 12px !important;
            transition: color 0.3s ease, background-color 0.3s ease;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .nav-link:hover { color: var(--primary-color) !important; background-color: rgba(255, 255, 255, 0.1); }
        .btn-outline-primary {
            color: var(--white);
            border-color: var(--white);
            font-size: 14px;
            padding: 6px 10px;
            border-width: 2px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-outline-primary:hover {
            background-color: var(--white);
            color: var(--dark-gray);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        footer {
            background-color: var(--nav-bg);
            color: var(--white);
            padding: 50px 0 20px;
        }
        footer h5 { color: var(--white); margin-bottom: 20px; font-weight: 600; }
        footer ul { padding-left: 0; list-style-type: none; }
        footer ul li { margin-bottom: 10px; }
        footer a { color: #bbb; text-decoration: none; transition: color 0.3s ease; }
        footer a:hover { color: var(--white); }
        .social-icons a {
            display: inline-block;
            width: 36px;
            height: 36px;
            line-height: 36px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            margin-right: 10px;
            transition: all 0.3s ease;
        }
        .social-icons a:hover { background-color: var(--primary-color); transform: translateY(-3px); }
        .mobile-nav { background-color: var(--nav-bg); border-top-left-radius: 15px; border-top-right-radius: 15px; box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1); }
        .mobile-menu { background-color: var(--mobile-menu-bg); border-top-left-radius: 15px; border-top-right-radius: 15px; padding: 15px; }
        .mobile-menu a {
            color: var(--white);
            text-decoration: none;
            padding: 10px 15px;
            display: block;
            transition: background-color 0.3s, transform 0.2s;
            border-radius: 8px;
        }
        .mobile-menu a:hover { background-color: rgba(255, 255, 255, 0.1); transform: translateX(5px); }
        .mobile-nav-icons { display: flex; justify-content: space-around; padding: 10px 0; }
        .mobile-nav-icon {
            color: var(--white);
            text-decoration: none;
            text-align: center;
            transition: transform 0.2s;
        }
        .mobile-nav-icon:hover { transform: translateY(-3px); }
        .mobile-nav-icon i { font-size: 1.5rem; margin-bottom: 5px; }
        .mobile-nav-icon span { display: block; font-size: 0.75rem; }
        .badge-floating {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 0.7rem;
            padding: 2px 5px;
        }
        @media (max-width: 991.98px) {
            .navbar-nav { background-color: var(--dark-gray); padding: 10px; border-radius: 5px; }
            .nav-item { margin: 5px 0; }
            .btn-outline-primary { display: block; width: 100%; text-align: center; margin-top: 10px; }
        }
        @media (max-width: 767.98px) {
            .top-bar { text-align: center; }
            .header { position: static; }
            .main-content { margin-bottom: 70px; }
        }
    </style>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Import Duty and Tax Calculator",
      "description": "Calculate assessable value, import duties and taxes for your international shipments",
      "url": "https://www.taxcalculator.bd/duty-calculator",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "All",
      "contactPoint": {
        "@type": "ContactPoint",
        "email": "shihab71284@gmail.com",
        "telephone": "+8801917179881",
        "contactType": "customer support"
      },
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="top-bar d-none d-md-block">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <span class="top-bar-icon">
                            <i class="fas fa-phone-alt"></i>
                            <a href="tel:+8801917179881" class="text-decoration-none text-dark">Call: +8801917179881</a>
                        </span>
                        <span class="top-bar-icon ms-3">
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:shihab71284@gmail.com" class="text-decoration-none text-dark">shihab71284@gmail.com</a>
                        </span>
                    </div>
                    <div class="col-md-6 text-end">
                        <a href="https://taxcalculator.bd/accounts/login/" class="top-bar-icon"><i class="fas fa-sign-in-alt"></i> Login</a>
                        <a href="https://taxcalculator.bd/accounts/signup" class="top-bar-icon"><i class="fas fa-user-plus"></i> Signup</a>
                    </div>
                </div>
            </div>
        </div>
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="https://taxcalculator.bd/">
                    <span class="logo-text">Content Share</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"><i class="fas fa-bars text-white"></i></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarContent">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a class="nav-link" href="https://taxcalculator.bd/">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="https://taxcalculator.bd/duty-calculator">Duty Calculator</a></li>
                        <li class="nav-item"><a class="nav-link" href="https://taxcalculator.bd/income-tax-calculator">Income Tax Cal</a></li>
                        <li class="nav-item"><a class="nav-link" href="https://taxcalculator.bd/search-result-vat/">VAT AI</a></li>
                    </ul>
                    <div class="ms-lg-2 mt-3 mt-lg-0 d-flex align-items-center">
                        <a href="https://taxcalculator.bd/my-dashboard" class="btn btn-outline-primary me-2"><i class="fas fa-user"></i></a>
                        <a href="https://taxcalculator.bd/my-wishlist" class="btn btn-outline-primary position-relative me-2">
                            <i class="fas fa-heart"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                        </a>
                        <a href="https://taxcalculator.bd/cart" class="btn btn-outline-primary position-relative">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger cart-count">0</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Mobile Navigation -->
    <div class="d-md-none fixed-bottom mobile-nav">
        <div class="collapse" id="mobileMenu">
            <div class="mobile-menu">
                <a href="https://taxcalculator.bd/"><i class="fas fa-home me-2"></i>Home</a>
                <a href="https://taxcalculator.bd/duty-calculator"><i class="fas fa-calculator me-2"></i>Duty Calculator</a>
                <a href="https://taxcalculator.bd/income-tax-calculator"><i class="fas fa-file-invoice-dollar me-2"></i>Income Tax Cal</a>
                <a href="https://taxcalculator.bd/search-result-vat/"><i class="fas fa-search me-2"></i>VAT AI</a>
            </div>
        </div>
        <div class="mobile-nav-icons">
            <button class="btn text-white" data-bs-toggle="collapse" data-bs-target="#mobileMenu">
                <i class="fas fa-bars"></i><span class="d-block small mt-1">Menu</span>
            </button>
            <a href="https://taxcalculator.bd/my-dashboard" class="mobile-nav-icon"><i class="fas fa-user"></i><span>Profile</span></a>
            <a href="https://taxcalculator.bd/my-wishlist" class="mobile-nav-icon position-relative">
                <i class="fas fa-heart"></i><span>Wishlist</span>
                <span class="badge bg-danger badge-floating">0</span>
            </a>
            <a href="https://taxcalculator.bd/cart" class="mobile-nav-icon position-relative">
                <i class="fas fa-shopping-cart"></i><span>Cart</span>
                <span class="badge bg-danger badge-floating cart-count">0</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container-fluid">
            <div class="main-content">
                <div class="calculator-container">
                    <h1>Import Duty and Tax Calculator</h1>
                    <form id="calculatorForm">
                        <input type="hidden" name="csrfmiddlewaretoken" value="dummy-token">
                        
                        <div class="outlined-field">
                            <input type="text" id="hsCode" name="hsCode" required pattern="\d+" placeholder=" " autocomplete="off">
                            <label for="hsCode">HS Code</label>
                        </div>
                        
                        <div class="outlined-field">
                            <input type="text" id="description" name="description" readonly placeholder=" ">
                            <label for="description">Description</label>
                        </div>
                        
                        <div id="errorMessage"></div>
                        <div id="loadingIndicator"><i class="fas fa-spinner fa-spin"></i> Loading tariff data...</div>
                        
                        <div class="outlined-field">
                            <select id="tradeTerms" name="tradeTerms" required>
                                <option value="" disabled selected> </option>
                                <option value="FOB">FOB (Free on Board)</option>
                                <option value="C&F">C&F (Cost and Freight)</option>
                                <option value="CIF">CIF (Cost Insurance and Freight)</option>
                            </select>
                            <label for="tradeTerms">Trade Terms</label>
                        </div>
                        
                        <div id="additionalFields"></div>
                        <div id="extraadditionalFields"></div>
                        
                        <button type="submit"><i class="fas fa-calculator me-2"></i>Calculate Duty</button>
                    </form>
                    <div id="results"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-6 mb-4 mb-md-0">
                    <h5>About Us</h5>
                    <p>Content Share is your go-to platform for accessing and sharing high-quality content. We connect creators and consumers in a vibrant, engaging community.</p>
                    <p class="mt-3"><i class="fas fa-envelope me-2"></i> shihab71284@gmail.com<br>
                       <i class="fas fa-phone me-2"></i> +8801917179881</p>
                </div>
                <div class="col-lg-4 col-md-6 mb-4 mb-md-0">
                    <h5>Quick Links</h5>
                    <ul>
                        <li><a href="https://taxcalculator.bd/">Home</a></li>
                        <li><a href="https://taxcalculator.bd/category-list">Categories</a></li>
                        <li><a href="https://taxcalculator.bd/brand-list">Authors</a></li>
                        <li><a href="https://taxcalculator.bd/contact">Contact Us</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-12">
                    <h5>Newsletter</h5>
                    <p>Stay updated with our latest content and offers.</p>
                    <form class="newsletter-form" onsubmit="event.preventDefault(); alert('Subscribed!');">
                        <div class="input-group mb-3">
                            <input type="email" class="form-control" placeholder="Enter your email" required>
                            <button class="btn btn-primary" type="submit">Subscribe</button>
                        </div>
                    </form>
                </div>
            </div>
            <hr class="mt-4 mb-3">
            <div class="row">
                <div class="col-md-6 mb-3 mb-md-0">
                    <p>Â© 2026 Content Share. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end social-icons">
                    <a href="#" class="text-light"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-light"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-light"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-light"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <script>
    $(document).ready(function() {
        // ===== CONFIGURATION =====
        const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTrBZSeQ-YGYBGz66IrcqooOmJ9ErQdDRj3iYqbgRw4hNRvjurOctn7lC83w4LCRtKQdhxsoXhYSEWf/pub?gid=2081232822&single=true&output=csv";
        const CACHE_KEY = 'tariff_csv_cache_v1';
        const CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours

        let hsCodeData = [];
        let isDataLoaded = false;

        // ===== CSV LOADING WITH CACHE =====
        function loadTariffData(callback) {
            const cached = localStorage.getItem(CACHE_KEY);
            if (cached) {
                try {
                    const { data, timestamp } = JSON.parse(cached);
                    if (Date.now() - timestamp < CACHE_EXPIRY) {
                        hsCodeData = JSON.parse(data);
                        isDataLoaded = true;
                        console.log("âœ“ Loaded from cache:", hsCodeData.length, "rows");
                        if (callback) callback();
                        return;
                    }
                } catch(e) { console.warn("Cache parse error:", e); }
            }
            
            $('#loadingIndicator').show().html('<i class="fas fa-spinner fa-spin"></i> Loading tariff database...');
            
            Papa.parse(SHEET_CSV_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    hsCodeData = results.data.filter(row => row['HS_Code'] || row['hs_code']);
                    isDataLoaded = true;
                    
                    // Save to cache
                    try {
                        localStorage.setItem(CACHE_KEY, JSON.stringify({
                            data: JSON.stringify(hsCodeData),
                            timestamp: Date.now()
                        }));
                    } catch(e) { console.warn("Cache save failed:", e); }
                    
                    $('#loadingIndicator').hide();
                    console.log("âœ“ CSV loaded:", hsCodeData.length, "rows");
                    if (callback) callback();
                },
                error: function(err) {
                    $('#loadingIndicator').hide();
                    $('#errorMessage').text('âš ï¸ Failed to load tariff data. Please check internet connection.').show();
                    console.error("CSV fetch error:", err);
                }
            });
        }

        // ===== HS CODE LOOKUP =====
        function findHsCode(code) {
            const search = code.toString().trim();
            return hsCodeData.find(row => {
                const hs = (row['HS_Code'] || row['hs_code'] || '').toString().trim();
                return hs.startsWith(search) || hs === search;
            });
        }

        $('#hsCode').on('input', function() {
            const hsCode = $(this).val().trim();
            $('#description').val('');
            $('#errorMessage').hide();
            
            if (hsCode.length < 4 || !/^\d+$/.test(hsCode)) {
                if (hsCode.length > 0) $('#errorMessage').text('Enter valid numeric HS Code (min 4 digits)').show();
                return;
            }

            if (!isDataLoaded) {
                $('#loadingIndicator').show().html('<i class="fas fa-spinner fa-spin"></i> Loading...');
                loadTariffData(() => lookupHsCode(hsCode));
            } else {
                lookupHsCode(hsCode);
            }
        });

        function lookupHsCode(hsCode) {
            const match = findHsCode(hsCode);
            
            if (match) {
                const desc = match['Description'] || match['description'] || 'N/A';
                const cdRate = parseFloat(match['CD_Rate'] || match['cd_rate'] || match['Customs_Duty'] || 0);
                const vatRate = parseFloat(match['VAT_Rate'] || match['vat_rate'] || match['VAT'] || 15);
                const unit = match['Unit'] || match['unit'] || 'PCS';
                
                $('#description').val(desc);
                window.tariffData = { cdRate, vatRate, unit, isHighCD: cdRate > 25 };
                $('#errorMessage').hide();
                
                // Show quantity field if high CD rate
                if (window.tariffData.isHighCD) {
                    showQuantityField(unit);
                } else {
                    $('#extraadditionalFields').empty();
                }
            } else {
                $('#description').val('');
                $('#errorMessage').text('HS Code not found. Please verify or try another code.').show();
                window.tariffData = null;
                $('#extraadditionalFields').empty();
            }
        }

        function showQuantityField(unit) {
            $('#extraadditionalFields').html(`
                <div class="outlined-field">
                    <input type="number" id="quantity" name="quantity" min="1" placeholder=" " required>
                    <label for="quantity">Number of Units</label>
                </div>
                <div class="outlined-field">
                    <input type="text" id="unitDisplay" name="unitDisplay" value="${unit}" readonly>
                    <label for="unitDisplay">Unit</label>
                </div>
            `);
        }

        // ===== TRADE TERMS DYNAMIC FIELDS =====
        $('#tradeTerms').on('change', function() {
            const tradeTerms = $(this).val();
            const additionalFields = $('#additionalFields');
            const extraFields = $('#extraadditionalFields');
            additionalFields.empty();
            if (!window.tariffData?.isHighCD) extraFields.empty();
            else showQuantityField(window.tariffData.unit);

            if (tradeTerms === 'FOB') {
                additionalFields.html(`
                    <div class="outlined-field">
                        <select id="freightType" name="freightType" required>
                            <option value="" disabled selected> </option>
                            <option value="ship">By Ship</option>
                            <option value="air">By Air</option>
                        </select>
                        <label for="freightType">Freight Type</label>
                    </div>
                `);
            } else if (tradeTerms === 'C&F') {
                additionalFields.html(`
                    <div class="outlined-field">
                        <input type="number" id="cnfValue" name="cnfValue" step="0.01" min="0" placeholder=" " required>
                        <label for="cnfValue">C&F Value (BDT)</label>
                    </div>
                    <div class="outlined-field">
                        <input type="number" id="insurance" name="insurance" step="0.01" readonly placeholder=" ">
                        <label for="insurance">Insurance (1% of C&F)</label>
                    </div>
                `);
                $('#cnfValue').on('input', function() {
                    const val = parseFloat($(this).val()) || 0;
                    $('#insurance').val((val * 0.01).toFixed(2));
                });
            } else if (tradeTerms === 'CIF') {
                additionalFields.html(`
                    <div class="outlined-field">
                        <input type="number" id="cifValue" name="cifValue" step="0.01" min="0" placeholder=" " required>
                        <label for="cifValue">CIF Value (BDT)</label>
                    </div>
                `);
            }
        });

        // Freight type handler for FOB
        $(document).on('change', '#freightType', function() {
            const freightType = $(this).val();
            if (!freightType) return;
            
            const extraFields = $('#extraadditionalFields');
            if (!window.tariffData?.isHighCD) extraFields.empty();
            else showQuantityField(window.tariffData.unit);
            
            extraFields.append(`
                <div class="outlined-field">
                    <input type="number" id="fobValue" name="fobValue" step="0.01" min="0" placeholder=" " required>
                    <label for="fobValue">FOB Value (BDT)</label>
                </div>
                <div class="outlined-field">
                    <input type="number" id="freight" name="freight" step="0.01" readonly placeholder=" ">
                    <label for="freight">Freight (<span id="freightRate">${freightType === 'ship' ? '20' : '15'}%)</span></label>
                </div>
            `);

            function updateCalculations() {
                const fob = parseFloat($('#fobValue').val()) || 0;
                if (fob > 0) {
                    const rate = freightType === 'ship' ? 0.20 : 0.15;
                    const freight = fob * rate;
                    const insurance = (fob + freight) * 0.01;
                    $('#freight').val(freight.toFixed(2));
                    if (!$('#insurance').length) {
                        // Add insurance field if not present
                        $('#extraadditionalFields').append(`
                            <div class="outlined-field">
                                <input type="number" id="insurance" name="insurance" step="0.01" readonly placeholder=" ">
                                <label for="insurance">Insurance (1%)</label>
                            </div>
                        `);
                    }
                    $('#insurance').val(insurance.toFixed(2));
                } else {
                    $('#freight').val('');
                    $('#insurance').val('');
                }
            }
            updateCalculations();
            $('#fobValue').on('input', updateCalculations);
        });

        // ===== FORM SUBMIT & CALCULATION =====
        $('#calculatorForm').on('submit', function(e) {
            e.preventDefault();
            
            if (!window.tariffData) {
                $('#errorMessage').text('Please select a valid HS Code first').show();
                return;
            }

            const tradeTerms = $('#tradeTerms').val();
            let baseValue = 0, freight = 0, insurance = 0;

            if (tradeTerms === 'FOB') {
                baseValue = parseFloat($('#fobValue').val()) || 0;
                freight = parseFloat($('#freight').val()) || 0;
                insurance = parseFloat($('#insurance').val()) || 0;
            } else if (tradeTerms === 'C&F') {
                baseValue = parseFloat($('#cnfValue').val()) || 0;
                insurance = parseFloat($('#insurance').val()) || 0;
            } else if (tradeTerms === 'CIF') {
                baseValue = parseFloat($('#cifValue').val()) || 0;
            }

            // Calculate Assessable Value (AV)
            const av = baseValue + freight + insurance;
            
            // Calculate Duties
            const cd = av * (window.tariffData.cdRate / 100);
            const vatBase = av + cd;
            const vat = vatBase * (window.tariffData.vatRate / 100);
            const total = av + cd + vat;
            const quantity = parseFloat($('#quantity').val()) || 1;
            const perUnit = total / quantity;

            // Display Results
            displayResults({
                value_results: {
                    "Assessable Value (AV)": av,
                    `Customs Duty (${window.tariffData.cdRate}%)`: cd,
                    `VAT (${window.tariffData.vatRate}%)`: vat,
                    "Total Duty & Tax Payable": total,
                    ...(quantity > 1 && { `Per Unit (${window.tariffData.unit})`: perUnit })
                },
                duty_details: {
                    "HS Code": $('#hsCode').val(),
                    "Description": $('#description').val(),
                    "Trade Terms": tradeTerms,
                    "Unit": window.tariffData.unit,
                    "Quantity": quantity
                }
            });
        });

        // ===== DISPLAY RESULTS =====
        function displayResults(results) {
            const resultsDiv = $('#results');
            resultsDiv.empty().show();

            function formatKey(key) {
                return key.replace(/([A-Z])/g, ' $1').replace(/^./, s => s.toUpperCase());
            }

            function createTable(data, title) {
                let html = `<h4 class="mt-4 mb-3">${title}</h4><table class="table table-bordered"><thead><tr><th width="10%">SL</th><th>Particulars</th><th width="30%" class="text-end">Value (BDT)</th></tr></thead><tbody>`;
                
                let sl = 1;
                const entries = Object.entries(data);
                entries.forEach(([key, value], index) => {
                    const isLast = index === entries.length - 1;
                    const rowClass = isLast ? 'total-row' : '';
                    const slCell = isLast ? '' : sl++;
                    html += `<tr class="${rowClass}">
                        <td class="text-center">${slCell}</td>
                        <td>${formatKey(key)}</td>
                        <td class="text-end fw-bold">${typeof value === 'number' ? value.toFixed(2) : value}</td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
                return html;
            }

            if (results.value_results) {
                resultsDiv.append(createTable(results.value_results, "ðŸ’° Calculation Summary"));
            }
            if (results.duty_details) {
                resultsDiv.append(createTable(results.duty_details, "ðŸ“‹ Import Details"));
            }

            // Scroll to results
            $('html, body').animate({ scrollTop: resultsDiv.offset().top - 100 }, 500);
        }

        // ===== INITIALIZE =====
        // Load CSV on page load (non-blocking)
        setTimeout(() => loadTariffData(), 500);

        // Mobile menu toggle icon fix
        const mobileMenu = document.getElementById('mobileMenu');
        if (mobileMenu) {
            mobileMenu.addEventListener('show.bs.collapse', () => {
                document.querySelector('[data-bs-target="#mobileMenu"] i').className = 'fas fa-times';
            });
            mobileMenu.addEventListener('hide.bs.collapse', () => {
                document.querySelector('[data-bs-target="#mobileMenu"] i').className = 'fas fa-bars';
            });
        }
    });
    </script>
</body>
</html>
